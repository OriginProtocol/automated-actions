FROM node:18-alpine

# Set working directory to backend
WORKDIR /app/backend

# Copy package files
COPY backend/package*.json ./

# Install all dependencies (both production and dev for concurrently)
RUN npm ci

# Copy backend source code
COPY backend/ ./

# Create logs directory
RUN mkdir -p logs

# Expose port for the server
EXPOSE 3000

# Use concurrently to run both server and cron in parallel
CMD ["npm", "run", "dev"]
